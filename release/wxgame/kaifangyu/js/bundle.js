"use strict"; var __extends = function () { var e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, a) { e.__proto__ = a } || function (e, a) { for (var t in a) a.hasOwnProperty(t) && (e[t] = a[t]) }; return function (a, t) { function i() { this.constructor = a } e(a, t), a.prototype = null === t ? Object.create(t) : (i.prototype = t.prototype, new i) } }(); !function () { function e(a, t, i) { function n(o, s) { if (!t[o]) { if (!a[o]) { var d = "function" == typeof require && require; if (!s && d) return d(o, !0); if (r) return r(o, !0); var l = new Error("Cannot find module '" + o + "'"); throw l.code = "MODULE_NOT_FOUND", l } var h = t[o] = { exports: {} }; a[o][0].call(h.exports, function (e) { return n(a[o][1][e] || e) }, h, h.exports, e, a, t, i) } return t[o].exports } for (var r = "function" == typeof require && require, o = 0; o < i.length; o++)n(i[o]); return n } return e }()({ 1: [function (e, a, t) { Object.defineProperty(t, "__esModule", { value: !0 }); var i = function () { function e() { } return e.init = function () { Laya.ClassUtils.regClass }, e.width = 640, e.height = 1136, e.scaleMode = "fixedwidth", e.screenMode = "none", e.alignV = "top", e.alignH = "left", e.startScene = "", e.sceneRoot = "", e.debug = !1, e.stat = !1, e.physicsDebug = !1, e.exportSceneToJson = !0, e }(); t.default = i, i.init() }, {}], 2: [function (e, a, t) { Object.defineProperty(t, "__esModule", { value: !0 }); var i = e("./GameConfig"), n = function () { function e() { Laya.isWXOpenDataContext = !0, Laya.isWXPosMsg = !0, window.Laya3D ? Laya3D.init(i.default.width, i.default.height) : Laya.init(i.default.width, i.default.height, Laya.WebGL), Laya.Physics && Laya.Physics.enable(), Laya.DebugPanel && Laya.DebugPanel.enable(), Laya.stage.scaleMode = i.default.scaleMode, Laya.stage.screenMode = i.default.screenMode, Laya.URL.exportSceneToJson = i.default.exportSceneToJson, (i.default.debug || "true" == Laya.Utils.getQueryString("debug")) && Laya.enableDebugPanel(), i.default.physicsDebug && Laya.PhysicsDebugDraw && Laya.PhysicsDebugDraw.enable(), i.default.stat && Laya.Stat.show(), Laya.alertGlobalError = !0, this.onConfigLoaded() } return e.prototype.onVersionLoaded = function () { Laya.AtlasInfoManager.enable("fileconfig.json", Laya.Handler.create(this, this.onConfigLoaded)) }, e.prototype.onConfigLoaded = function () { var e = this; if (Laya.Browser.onMiniGame) { var a = Laya.Browser.window.wx; a.onMessage(function (t) { if ("ranking" == t.action) { var i = t.gameData[0]; Laya.Browser.window.scX = i; var n = t.gameData[1]; a.getFriendCloudStorage({ keyList: ["score"], success: function (a) { null != Laya.stage.getChildByName("layaList") && Laya.stage.removeChildByName("layaList"); var t = e.sortData(a.data), i = new Laya.Sprite; i.name = "layaList"; var o = e.getUserIndex(t, n), s = new Laya.List, d = Laya.Browser.window.scX; Laya.Browser.window.scY; s.itemRender = r, s.repeatX = 1, s.repeatY = 6, s.x = 0, s.y = 0, s.vScrollBarSkin = "", s.selectEnable = !0; for (var l = [], h = 0; h < t.length; ++h) { if (0 == t[h].KVDataList.length) return; var g = new Laya.Sprite; g.width = 640 * d, g.height = 158 * d, g.pos(0, 5 * h), g.loadImage("kaifangyu/img/right1.png"); var f = new Laya.Sprite; f.width = 640 * d, f.height = 158 * d, f.pos(0, 0), f.loadImage("kaifangyu/img/right.png"), g.addChild(f); var u = new Laya.Sprite; u.width = 84 * d, u.height = 87 * d, u.loadImage("kaifangyu/img/rlbg.png"); var c; c = new Laya.Text, c.text = "" + (h + 1), c.color = "#fff", c.fontSize = 28 * d, c.width = u.width / 1.2, c.align = "center", c.pos(0, (u.height - c.height) / 1.5), u.pos(20 * d, (f.height - u.height) / 2), u.addChild(c), f.addChild(u); var y = new Laya.Sprite, p = new Laya.Sprite; p.width = 89 * d, p.height = 89 * d, p.loadImage("kaifangyu/img/cir.png"); var L = new Laya.Sprite; L.width = 89 * d, L.height = 89 * d, L.loadImage(t[h].avatarUrl), y.pos(u.x + u.width + 10 * d, (f.height - p.height) / 2), y.addChild(p), y.addChild(L), y.mask = p, f.addChild(y); var w = new Laya.Sprite; w.width = 389 * d, w.height = 94 * d, w.loadImage("kaifangyu/img/list1.png"), w.pos(y.x + L.width + 10 * d, (f.height - w.height) / 2); var v = new Laya.Text, m = t[h].nickname.toString().length > 6 ? t[h].nickname.substring(0, 6) + "..." : t[h].nickname; v.text = "" + m, v.color = "#fff", v.fontSize = 26 * d, v.bold = !0, v.pos(15 * d, (w.height - v.height) / 2), w.addChild(v); var C = new Laya.Text; C.text = t[h].KVDataList[0].value + "关", C.align = "right", C.color = "#fff99a", C.fontSize = 30 * d, C.pos(w.width - C.width - 15 * d, (w.height - C.getBounds().height) / 2), w.addChild(C), f.addChild(w), l.push(g) } s.array = l, i.pos(0, 0); var D = new Laya.Sprite; D.width = 620 * d, D.height = 98 * d, D.pos((640 * d - 620 * d) / 2, 850 * d), D.loadImage("kaifangyu/img/my.png"); var S = new Laya.Text; S.text = "你的排名", S.color = "#482b1c", S.fontSize = 30 * d, S.pos(40 * d, (D.height - S.height) / 2), D.addChild(S); var x = new Laya.Text; -1 == o ? (x.text = "∞", x.align = "right", x.color = "#fff", x.stroke = 1, x.strokeColor = "#21201f", x.fontSize = 30 * d) : (x.text = "" + (o + 1), x.align = "right", x.color = "#fff", x.stroke = 1, x.strokeColor = "#21201f", x.fontSize = 30 * d), x.pos(D.width - x.width - 40 * d, (D.height - x.height) / 2), D.addChild(x), i.addChild(s), i.addChild(D), Laya.stage.addChild(i) } }) } else if ("set" == t.action) a.getUserCloudStorage({ keyList: ["score"], success: function (e) { (void 0 == e.KVDataList[0] || parseFloat(e.KVDataList[0].value) <= t.score) && (console.log("记录数据"), a.setUserCloudStorage({ KVDataList: [{ key: "score", value: t.score.toString() }], success: function () { console.log("-------存储-----：") } })) } }); else if ("overstep" == t.action) { var o = t.score; a.getFriendCloudStorage({ keyList: ["score"], success: function (a) { null != Laya.stage.getChildByName("overstep") && Laya.stage.removeChildByName("overstep"); var i = e.sortDataUp(a.data), n = e.userScoreIndex(i, o), r = new Laya.Sprite; r.name = "overstep"; var s = t.scX; if (-1 != n && 0 != i[n].KVDataList.length) { var d = new Laya.Sprite, l = new Laya.Sprite; l.width = 80 * s, l.height = 80 * s, l.loadImage("kaifangyu/img/cir.png"); var h = new Laya.Sprite; h.width = 80 * s, h.height = 80 * s, h.loadImage(i[n].avatarUrl), d.pos(15 * s, 35 * s), d.addChild(l), d.addChild(h), d.mask = l; var g = i[n].nickname.toString().length > 6 ? i[n].nickname.substring(0, 6) + "..." : i[n].nickname, f = new Laya.Text; f.fontSize = 22 * s, f.color = "#fff", f.align = "center", f.width = 120 * s, f.text = g, f.pos(90 * s, 50 * s); var u = new Laya.Text; u.fontSize = 28 * s, u.color = "#fff", u.text = i[n].KVDataList[0].value + "关", u.align = "center", u.width = 120 * s, u.pos(90 * s, f.y + 1.2 * f.height), r.addChild(f), r.addChild(d), r.addChild(u), r.pos(0, 0) } else { var c = new Laya.Text; c.fontSize = 24 * s, c.color = "#feff38", c.text = "恭喜你，荣登首榜！", c.width = 210 * s, c.align = "center", c.wordWrap = !0, c.pos((220 * s - c.width) / 2, (118 * s - c.height / 1.5) / 2), r.addChild(c), r.pos(0, 0) } Laya.stage.addChild(r) } }) } else "clear" == t.action ? (null != Laya.stage.getChildByName("overstep") && Laya.stage.removeChildByName("overstep"), null != Laya.stage.getChildByName("layaList") && Laya.stage.removeChildByName("layaList")) : t.action = "uploadSource" }) } }, e.prototype.getImage = function (e, a, t, i, n) { void 0 === i && (i = 0), void 0 === n && (n = 0); var r = new Laya.Sprite; return r.width = a, r.height = t, r.loadImage("" + e), r.pos(i, n), r }, e.prototype.userScoreIndex = function (e, a) { for (var t = 0; t < e.length; ++t)if (0 != e[t].KVDataList.length && parseInt(e[t].KVDataList[0].value) > a) return t; return -1 }, e.prototype.getUserIndex = function (e, a) { for (var t = 0; t < e.length; t++)if (e[t].openid == a) return t; return -1 }, e.prototype.sortData = function (e) { for (var a = 0; a < e.length; a++)for (var t = 0; t < e.length; t++) { var i; 0 != e[a].KVDataList.length && 0 != e[t].KVDataList.length && parseInt(e[a].KVDataList[0].value) > parseInt(e[t].KVDataList[0].value) && (i = e[a], e[a] = e[t], e[t] = i) } return e }, e.prototype.sortData1 = function (e) { for (var a = 0; a < e.length; a++)for (var t = 0; t < e.length; t++) { var i; 0 != e[a].KVDataList.length && parseInt(e[a].KVDataList[1].value) > parseInt(e[t].KVDataList[1].value) && (i = e[a], e[a] = e[t], e[t] = i) } return e }, e.prototype.sortDataUp = function (e) { for (var a = 0; a < e.length; a++)for (var t = 0; t < e.length; t++) { var i; 0 != e[a].KVDataList.length && e[t].KVDataList.length && parseInt(e[a].KVDataList[0].value) < parseInt(e[t].KVDataList[0].value) && (i = e[a], e[a] = e[t], e[t] = i) } return e }, e }(), r = function (e) { function a() { var a = e.call(this) || this; return a.size(640 * Laya.Browser.window.scX, 140 * Laya.Browser.window.scX), a } return __extends(a, e), a }(Laya.Box); new n }, { "./GameConfig": 1 }] }, {}, [2]);